var currentFrame="frameLab126-1";var deviceW=0;var deviceH=0;var ltr=1;var orientationLock="unlocked";var READABLE_FONT_SIZE=30;var COMIC="comic";var CHILDREN="children";var MANGA="manga";var LOADED="loaded";var LOADING="loading";var PAGE_SPREAD_LEFT="page-spread-left";var PAGE_SPREAD_RIGHT="page-spread-right";var FACING_PAGE_LEFT="facing-page-left";var FACING_PAGE_RIGHT="facing-page-right";var CENTER="center";var INVALID_PAGE_VALUE=-1;var HALF_SPINE_SIZE=5;var curBasePage=INVALID_PAGE_VALUE;var curPairedPage=INVALID_PAGE_VALUE;var oriContentWidth=0;var oriContentHeight=0;var gBookType="";var maxZoom=3;function setMaxZoom(a){maxZoom=maxZoom*a;}function setContentResolution(b,a){oriContentWidth=b;oriContentHeight=a;}function setBookType(a){gBookType=a;}function addCustomRules(a){var c=document.getElementById(a.valueOf());var b=c.contentDocument.createElement("style");b.innerHTML="html::-webkit-scrollbar { width:12px; height:12px; } html::-webkit-scrollbar-track:horizontal { background-color: black; border-bottom: 6px solid white;border-top: 5px solid white; } html::-webkit-scrollbar-track:vertical { background-color: black; border-right: 6px solid white; border-left: 5px solid white; } html::-webkit-scrollbar-thumb:horizontal { background-color: black; border-bottom: 4px solid white; border-top: 3px solid white; } html::-webkit-scrollbar-thumb:vertical { background-color: black;  border-right: 4px solid white; border-left: 3px solid white; }";if(gBookType!=CHILDREN){b.innerHTML+=" img { margin: 0px !important; padding: 0px !important; }";}b.type="text/css";c.contentDocument.getElementsByTagName("head")[0].appendChild(b);}function loaded(){if(event.srcElement.src!=""){if(!isSinglePage()){fitLoadedContent(event.srcElement.id,deviceW/2,deviceH);}else{fitLoadedContent(event.srcElement.id,deviceW,deviceH);}addCustomRules(event.srcElement.id);jsCallBack_FrameInfo(parseInt(event.srcElement.getAttribute("page")),event.srcElement.id);event.srcElement.setAttribute("data-pageLoadStatus",LOADED);}}function makeLeftPage(d,a,c){var b=(c)?HALF_SPINE_SIZE:0;d.style.display="inline";d.style.position="absolute";d.style.left="0px";d.style.top="0px";d.style.margin="0px";d.style.border="";d.setAttribute("side","left");if(a==true){fitLoadedContent(d.id,deviceW/2-b,deviceH);}}function makeRightPage(d,a,c){var b=(c)?HALF_SPINE_SIZE:0;d.style.display="inline";d.style.position="absolute";d.style.left=parseInt(deviceW/2+b)+"px";d.style.top="0px";d.style.margin="0px";d.style.border="";d.setAttribute("side","right");if(a==true){fitLoadedContent(d.id,deviceW/2-b,deviceH);}}function showAndPositionTwoPages(c,a,b,h){var e=c;var f=a;if(f.getAttribute("page")==INVALID_PAGE_VALUE){makeFullPage(c,h);return;}var g=document.getElementsByTagName("iframe");for(i=0;i<g.length;i++){if((g[i].id!=c.id)&&(g[i].id!=a.id)){g[i].setAttribute("data-frameStatus","hidden");g[i].style.display="inline";g[i].style.position="absolute";g[i].style.left=deviceW+"px";g[i].style.top="0px";}}var d=c.getAttribute("data-pageProperty");var j=(d!=PAGE_SPREAD_LEFT)&&(d!=PAGE_SPREAD_RIGHT);if(d==PAGE_SPREAD_LEFT||d==FACING_PAGE_LEFT){makeLeftPage(c,h,j);makeRightPage(a,h,j);}else{if(d==PAGE_SPREAD_RIGHT||d==FACING_PAGE_RIGHT){makeRightPage(c,h,j);makeLeftPage(a,h,j);}else{if(c.getAttribute("page")>a.getAttribute("page")){e=a;f=c;}if(b==1){makeLeftPage(e,h,j);makeRightPage(f,h,j);}else{makeRightPage(e,h,j);makeLeftPage(f,h,j);}}}}function loadTwoPages(j,e,m,k,f,c,b,l){var h=findFrameForPage(curBasePage);var g=findFrameForPage(curPairedPage);if(h!=null){h.setAttribute("data-frameStatus","hidden");}if(g!=null){g.setAttribute("data-frameStatus","hidden");}deviceW=f;deviceH=c;orientationLock=l;ltr=b;curBasePage=j;curPairedPage=e;var d=findFrameForPage(j);if(d==null){d=getAvailableFrame();d.setAttribute("data-pageLoadStatus",LOADING);d.src="";d.src="kindle:"+parseInt(j)+"?mime=text/html";}d.setAttribute("page",parseInt(j));d.setAttribute("data-pageProperty",m);clearFrameAttributes(d);currentFrame=d.id;d.setAttribute("data-frameStatus","shown");var a=findFrameForPage(e);if(a==null){a=getAvailableFrame();a.setAttribute("data-pageLoadStatus",LOADING);a.src="";a.src="kindle:"+parseInt(e)+"?mime=text/html";}clearFrameAttributes(a);a.setAttribute("page",parseInt(e));a.setAttribute("data-pageProperty",k);a.setAttribute("data-frameStatus","shown");if(d.getAttribute("data-pageLoadStatus")==LOADED){fitLoadedContent(d.id,deviceW/2,deviceH);jsCallBack_FrameInfo(d.getAttribute("page"),d.id);}if(a.getAttribute("data-pageLoadStatus")==LOADED){fitLoadedContent(a.id,deviceW/2,deviceH);jsCallBack_FrameInfo(a.getAttribute("page"),a.id);}}function loadPage(e,j,c,b,a,h){deviceW=c;deviceH=b;orientationLock=h;ltr=a;var d=findFrameForPage(curBasePage);if(d!=null){d.setAttribute("data-frameStatus","hidden");}var f=findFrameForPage(e);curBasePage=e;curPairedPage=INVALID_PAGE_VALUE;if(f==null){var g=getAvailableFrame();clearFrameAttributes(g);g.setAttribute("data-pageLoadStatus",LOADING);g.src="";g.setAttribute("data-frameStatus","shown");g.src="kindle:"+parseInt(e)+"?mime=text/html";g.setAttribute("page",parseInt(e));g.setAttribute("data-pageProperty",j);currentFrame=g.id;makeFullPage(g,false);}else{currentFrame=f.id;f.setAttribute("data-frameStatus","shown");makeFullPage(f,false);if(f.getAttribute("data-pageLoadStatus")==LOADED){console.log("PAGE ALREADY LOADED");fitLoadedContent(currentFrame,c,b);jsCallBack_FrameInfo(f.getAttribute("page"),f.id);}else{console.log("PAGE LOADING INITIATED AND PENDING COMPLETE");}}}function setOrientation(a,b){deviceW=a;deviceH=b;}function showTwoPages(d,c){curBasePage=d;curPairedPage=c;var b=findFrameForPage(d);currentFrame=b.id;if(b.getAttribute("data-panelFitZoom")){showFrame(b);return;}var a=findFrameForPage(parseInt(c));showAndPositionTwoPages(b,a,ltr,true);}function showPage(a){var b=findFrameForPage(a);showFrame(b);currentFrame=b.id;if(b.getAttribute("data-panelFitZoom")){return;}curBasePage=a;makeFullPage(b,true);}function getAvailableFrame(){var c=document.getElementsByTagName("iframe");for(var a=0;a<c.length;a++){var b=c[a].getAttribute("page");if((c[a].getAttribute("data-frameStatus")=="hidden"&&c[a].getAttribute("data-pageLoadStatus")!=LOADING&&b!=curBasePage&&b!=(curBasePage+1)&&b!=(curBasePage-1))||b==INVALID_PAGE_VALUE){return c[a];}}return null;}function bgLoad(c,a){var b=findFrameForPage(c);if(deviceW>deviceH&&orientationLock!="landscape"){return 1;}if(b==null){var d=getAvailableFrame();console.log("Loading an additional page in the background "+c+" in frame "+d.id);clearFrameAttributes(d);d.setAttribute("data-pageLoadStatus",LOADING);d.setAttribute("data-pageProperty",a);d.setAttribute("data-frameStatus","hidden");d.src="";d.src="kindle:"+parseInt(c)+"?mime=text/html";d.setAttribute("page",parseInt(c));return 0;}else{return 1;}}function getBoundingBox(b){var f=document.getElementById(b.valueOf());var g=f.contentWindow.document.getElementsByClassName("app-amzn-magnify");var h={panelBBoxes:{}};var a=0;for(a=0;a<g.length;a++){var e=g[a].getBoundingClientRect();var c=g[a].getAttribute("data-app-amzn-magnify");var d=JSON.parse(c).ordinal;h.panelBBoxes[d]={x:Math.round(e.left),y:Math.round(e.top),w:Math.round(e.width),h:Math.round(e.height)};}var j=JSON.stringify(h);return j;}function getCurrentZoom(b){if(gBookType==CHILDREN){var a=b.webkitTransform.split("(");if(a.length==2&&a[0]=="scale"){return parseFloat(a[1]);}return 0;}else{return(b.zoom&&b.zoom.length)?parseFloat(b.zoom):0;}}function setCurrentZoom(b,c,a,d){if(gBookType==CHILDREN){b.webkitTransformOrigin="0 0";b.webkitTransform="scale("+c+")";if(a>0){b.width=a+"px";}if(d>0){b.height=d+"px";}}else{b.zoom=c;}}function isPageZoomed(){var e=document.getElementById(currentFrame.valueOf());var b=getCurrentZoom(e.contentWindow.document.body.style);var d=1;var a=e.getAttribute("data-fitZoom");var c=e.getAttribute("data-panelFitZoom");if(!c){if(parseFloat(b)==parseFloat(a)){d=0;}}else{if(parseFloat(b)==parseFloat(c)){d=0;}}return parseInt(d);}function prepareBodyStyle(a){a.style.margin="0px !important";a.style.border="";a.style.cssFloat="none";}function alignContent(m,d,g,e,b,k){var l=m.contentDocument.body;var n=g*getCurrentZoom(l.style);var a=d*getCurrentZoom(l.style);var c=0;var h=0;var f=(gBookType==CHILDREN)?1:getCurrentZoom(l.style);if(a<e){c=Math.floor((e-a)/(2*f));}if(n<b){h=Math.floor((b-n)/(2*f));}if(k==PAGE_SPREAD_LEFT){l.style.cssFloat="right";l.style.marginTop=h+"px !important";}else{if(k==PAGE_SPREAD_RIGHT){l.style.marginLeft=parseInt(0)+"px !important";l.style.marginTop=h+"px !important";}else{l.style.cssFloat="none";l.style.marginLeft=c+"px !important";l.style.marginTop=h+"px !important";}}if((gBookType==CHILDREN)&&!isPageZoomed()){l.scrollTop=0;l.scrollLeft=0;var j=m.contentWindow.document.getElementsByTagName("html")[0];j.style.overflow="hidden";}console.log("top is "+l.style.marginTop+"; left is "+l.style.marginLeft);}function topLeft(a,c){var e=document.getElementById(a.valueOf());var d=e.contentWindow.document.body;var b=e.contentWindow.document.getElementsByTagName("html")[0];b.style.overflow="hidden";d.style.zoom=parseFloat(e.getAttribute("data-fitZoom")*c);d.scrollLeft=0;d.scrollTop=0;e.setAttribute("data-panelFitZoom",parseFloat(d.style.zoom));e.setAttribute("data-panelLeft",d.scrollLeft);e.setAttribute("data-panelTop",d.scrollTop);if(deviceW<deviceH||orientationLock=="landscape"){e.setAttribute("data-panelWidth",(e.getAttribute("data-originalWidth")*d.style.zoom)/c);}else{e.setAttribute("data-panelWidth",e.getAttribute("data-originalWidth")*d.style.zoom);}e.setAttribute("data-panelHeight",((e.getAttribute("data-originalHeight")*d.style.zoom)/c));}function topRight(a,c){var e=document.getElementById(a.valueOf());var d=e.contentWindow.document.body;var b=e.contentWindow.document.getElementsByTagName("html")[0];b.style.overflow="hidden";d.style.zoom=parseFloat(e.getAttribute("data-fitZoom")*c);d.scrollLeft=d.scrollWidth-d.clientWidth;d.scrollTop=0;e.setAttribute("data-panelFitZoom",parseFloat(d.style.zoom));e.setAttribute("data-panelLeft",d.scrollLeft);e.setAttribute("data-panelTop",d.scrollTop);e.setAttribute("data-panelWidth",(e.getAttribute("data-originalWidth")*d.style.zoom)/c);e.setAttribute("data-panelHeight",(e.getAttribute("data-originalHeight")*d.style.zoom)/c);}function bottomLeft(a,c){var e=document.getElementById(a.valueOf());var d=e.contentWindow.document.body;var b=e.contentWindow.document.getElementsByTagName("html")[0];b.style.overflow="hidden";d.style.zoom=parseFloat(e.getAttribute("data-fitZoom")*c);d.scrollLeft=0;d.scrollTop=d.scrollHeight-d.clientHeight;e.setAttribute("data-panelFitZoom",parseFloat(d.style.zoom));e.setAttribute("data-panelLeft",d.scrollLeft);e.setAttribute("data-panelTop",d.scrollTop);if(deviceW<deviceH||orientationLock=="landscape"){e.setAttribute("data-panelWidth",(e.getAttribute("data-originalWidth")*d.style.zoom)/c);}else{e.setAttribute("data-panelWidth",e.getAttribute("data-originalWidth")*d.style.zoom);}e.setAttribute("data-panelHeight",(e.getAttribute("data-originalHeight")*d.style.zoom)/c);}function bottomRight(a,c){var e=document.getElementById(a.valueOf());var d=e.contentWindow.document.body;var b=e.contentWindow.document.getElementsByTagName("html")[0];b.style.overflow="hidden";d.style.zoom=parseFloat(e.getAttribute("data-fitZoom")*c);d.scrollLeft=d.scrollWidth-d.clientWidth;d.scrollTop=d.scrollHeight-d.clientHeight;e.setAttribute("data-panelFitZoom",parseFloat(d.style.zoom));e.setAttribute("data-panelLeft",d.scrollLeft);e.setAttribute("data-panelTop",d.scrollTop);e.setAttribute("data-panelWidth",(e.getAttribute("data-originalWidth")*d.style.zoom)/c);e.setAttribute("data-panelHeight",(e.getAttribute("data-originalHeight")*d.style.zoom)/c);}function getOffsetLeft(a){var b=document.getElementById(a.valueOf());return b.offsetLeft;}function getOffsetTop(a){var b=document.getElementById(a.valueOf());return b.offsetTop;}function findFrameForPage(c){var d=document.getElementsByTagName("iframe");var a=0;for(a=0;a<d.length;a++){var b=d[a].getAttribute("page");if(b==c){return d[a];}}return null;}function showFrame(b){var c=document.getElementsByTagName("iframe");var a=0;for(a=0;a<c.length;a++){var d=c[a].id;if(d==b.id){c[a].style.display="inline";}else{c[a].style.display="inline";c[a].style.position="absolute";c[a].style.left=deviceW+"px";c[a].style.top="0px";c[a].setAttribute("data-frameStatus","hidden");}}b.style.position="absolute";b.style.left="0px";b.style.top="0px";b.style.margin="0px";b.style.border="";}function makeFullPage(b,a){showFrame(b);if(a==true){fitLoadedContent(b.id,deviceW,deviceH);}}function storeTransitionValues(k,w,h,m,s){var t=findFrameForPage(k);var v=0;var u=0;var o=0;var n=0;var r=0;var q=0;var t=findFrameForPage(k);var l=findFrameForPage(h);var p=t.contentWindow.document.body;var f=p.scrollWidth-p.clientWidth;var d=0;var b=0;var a=0;var j=p.scrollWidth-p.clientWidth;var g=p.scrollHeight-p.clientHeight;var e=0;var c=p.scrollHeight-p.clientHeight;switch(m.valueOf()){case"tr":r=f;q=d;break;case"tl":r=b;q=a;break;case"br":r=j;q=g;break;case"bl":r=e;q=c;break;case"top":if(l.getAttribute("side")=="left"){r=b;q=a;}else{r=f;q=d;}break;case"bottom":if(l.getAttribute("side")=="left"){r=e;q=c;}else{r=j;q=g;}break;}switch(w.valueOf()){case"tl":o=b;n=a;break;case"tr":o=f;n=d;break;case"br":o=j;n=g;break;case"bl":o=e;n=c;break;case"top":if(t.getAttribute("side")=="left"){o=b;n=a;}else{o=f;n=d;}break;case"bottom":if(t.getAttribute("side")=="left"){o=e;n=c;}else{o=j;n=g;}break;}t.setAttribute("transition-dstPage",parseInt(k));t.setAttribute("transition-dstPanel",w);t.setAttribute("transition-srcPage",parseInt(h));t.setAttribute("transition-srcPanel",m);t.setAttribute("transition-totalFrames",parseInt(s));t.setAttribute("transition-distanceX",parseInt(o-r));t.setAttribute("transition-distanceY",parseInt(n-q));}function transitToVirtualPanel(g,z,f,l,o,s,v){if(o==1){gotoVirtualPanel(f,l,v);}var w=findFrameForPage(g);var b=parseInt(w.getAttribute("transition-dstPage"));var q=w.getAttribute("transition-dstPanel");var m=parseInt(w.getAttribute("transition-srcPage"));var a=w.getAttribute("transition-srcPanel");var h=parseInt(w.getAttribute("transition-totalFrames"));if(o==1||b!=g||q!=z||m!=f||a!=l||h!=s){storeTransitionValues(g,z,f,l,s);}var u=parseInt(w.getAttribute("transition-distanceX"));var t=parseInt(w.getAttribute("transition-distanceY"));if(o<s){var y=parseInt(u/Math.pow(2,o));var x=parseInt(t/Math.pow(2,o));panViewAllowOverwrite(y,x,1);}else{var n=w.contentDocument.body.style.zoom;var r=w.getAttribute("data-panelFitZoom");var e=w.getAttribute("data-fitZoom");var k=0;if(n!=r){k=1;}if(k==1){w.contentDocument.body.style.zoom=r;}var p=w.contentDocument.body;var j=w.contentDocument.getElementsByTagName("html")[0];j.style.overflow="hidden";var d=p.scrollLeft;var c=p.scrollTop;gotoVirtualPanelInFrame(w,z,(r/e));w.setAttribute("data-deltaX",parseInt(d-p.scrollLeft));w.setAttribute("data-deltaY",parseInt(c-p.scrollTop));if(k==1){prepareBodyStyle(w.contentDocument.body);alignContent(w,parseInt(w.getAttribute("data-originalWidth")),parseInt(w.getAttribute("data-originalHeight")),deviceW,deviceH,CENTER);}return k;}}function gotoVirtualPanelInFrame(c,a,b){switch(a.valueOf()){case"tr":topRight(c.id,b);break;case"tl":topLeft(c.id,b);break;case"br":bottomRight(c.id,b);break;case"bl":bottomLeft(c.id,b);break;case"top":topLeft(c.id,b);break;case"bottom":bottomLeft(c.id,b);break;}}function gotoVirtualPanel(d,a,b){clearFrameAttributes(document.getElementById(currentFrame.valueOf()));var c=findFrameForPage(d);resetFrameSize(c);currentFrame=c.id;if(isSinglePage()){makeFullPage(c,true);}else{var f=findFrameForPage(curBasePage);var e=findFrameForPage(curPairedPage);showAndPositionTwoPages(f,e,ltr,true);}gotoVirtualPanelInFrame(c,a,b);if(!isSinglePage()){setFrameSize(c,deviceW,deviceH);showFrame(c);}prepareBodyStyle(c.contentDocument.body);alignContent(c,parseInt(c.getAttribute("data-originalWidth")),parseInt(c.getAttribute("data-originalHeight")),deviceW,deviceH,CENTER);c.setAttribute("data-panelType",MANGA);}function resetFrameSize(a){a.style.width="";a.style.height="";}function setFrameSize(c,b,a){c.style.width=b+"px";c.style.height=a+"px";}function detectContentDimension(g){var a=0;var f=0;var h=g.createTreeWalker(g.body,NodeFilter.SHOW_ALL,null,false);while(node=h.nextNode()){if(node.nodeName=="IMG"){var d=node;var b=g.defaultView.getComputedStyle(d);if(b.visibility!="hidden"&&b.display!="none"){var c=d.getBoundingClientRect();if(c.width>0&&c.height>0&&c.right>0&&c.bottom>0){if(c.right>a){a=c.right;}if(c.bottom>f){f=c.bottom;}}}}}console.log("Detected Content Dimension: "+a+" x "+f);return{width:a,height:f};}function fitLoadedContent(g,c,a){var d=document.getElementById("divScroll");d.style.overflow="hidden";d.scrollLeft=0;d.scrollTop=0;var m=document.getElementById(g.valueOf());var p=m.contentDocument.body;prepareBodyStyle(p);resetFrameSize(m);var k=m.contentWindow.document.getElementsByTagName("html")[0];k.style.overflow="hidden";var h=m.contentDocument.images;for(i=0;i<h.length;i++){if(((h[i].style.left==""&&h[i].style.top=="")||gBookType=="manga")&&(h[i].style.width=="100%"||h[i].style.height=="100%")){h[i].style.height="";h[i].style.width="";}if(oriContentWidth==0&&oriContentHeight==0){h[i].style.textAlign="left !important";elementParent=h[i].parentNode;while(elementParent!=null&&elementParent!=m.contentDocument.body){elementParent.style.textAlign="left !important";elementParent=elementParent.parentNode;}}}var b=0;var f=0;if(!m.getAttribute("data-originalWidth")&&!m.getAttribute("data-originalHeight")){p.style.zoom=1;if(oriContentWidth!=0&&oriContentHeight!=0){if(m.getAttribute("data0-originalWidth")){b=m.getAttribute("data0-originalWidth");f=m.getAttribute("data0-originalHeight");}else{b=oriContentWidth;f=oriContentHeight;if(p.scrollWidth>b||p.scrollHeight>f){var o=detectContentDimension(m.contentWindow.document);b=Math.max(oriContentWidth,o.width);f=Math.max(oriContentHeight,o.height);}m.setAttribute("data0-originalWidth",b);m.setAttribute("data0-originalHeight",f);console.log("Original Content Dimension: "+m.getAttribute("data-originalWidth")+" x "+m.getAttribute("data-originalHeight")+" on "+m.id);}}else{b=p.scrollWidth;f=p.scrollHeight;}}else{b=parseInt(m.getAttribute("data-originalWidth"));f=parseInt(m.getAttribute("data-originalHeight"));}var n=c/b;var e=a/f;var l=1*Math.min(n,e);m.setAttribute("data-fitZoom",parseFloat(l));console.log("fit zoom is "+parseFloat(m.getAttribute("data-fitZoom")));setCurrentZoom(p.style,l,b,f);var j=CENTER;if(!isSinglePage()){if(m.getAttribute("data-pageProperty")){j=m.getAttribute("data-pageProperty");}}alignContent(m,b,f,c,a,j);setFrameSize(m,c,a);m.setAttribute("data-originalWidth",b);m.setAttribute("data-originalHeight",f);}function getFrameAtLocation(l,j){if(!isSinglePage()){var d=document.getElementById("divScroll");var m=d.scrollTop;var f=d.scrollLeft;var b=parseInt(f)+l;var o=parseInt(m)+j;var g=document.getElementsByTagName("iframe");var e=0;for(e=0;e<g.length;e++){var k=g[e];var c=parseInt(k.offsetLeft);var n=parseInt(k.offsetLeft)+parseInt(k.style.width);var h=parseInt(k.offsetTop);var a=parseInt(k.offsetTop)+parseInt(k.style.height);if(b>=c&&b<=n&&o>=h&&o<=a){return k.id;}}return"";}else{return currentFrame;}}function zoomTwoPageView(l,k,g){var s=document.getElementById("divScroll");var f=findFrameForPage(curBasePage);var d=findFrameForPage(curPairedPage);var m=f.contentDocument.body;var c=d.contentDocument.body;prepareBodyStyle(m);prepareBodyStyle(c);var t=s.scrollLeft+l;var q=s.scrollTop+k;s.style.width=deviceW+"px";s.style.height=deviceH+"px";var j=getCurrentZoom(m.style);var b=Math.min(j*g,maxZoom);b=Math.max(b,f.getAttribute("data-fitZoom")*1);setCurrentZoom(m.style,b,0,0);var u=b/j;var h=getCurrentZoom(c.style);var a=Math.min(h*g,maxZoom);a=Math.max(a,d.getAttribute("data-fitZoom")*1);setCurrentZoom(c.style,a,0,0);var r=a/h;var e=f.getAttribute("data-fitZoom");var n=d.getAttribute("data-fitZoom");if((b<=e)||(a<=n)){setCurrentZoom(m.style,e,0,0);setCurrentZoom(c.style,n,0,0);showAndPositionTwoPages(f,d,ltr,true);return;}f.style.position="static";d.style.position="static";f.style.margin="0px";d.style.margin="0px";setFrameSize(f,parseInt(f.style.width)*u,parseInt(f.style.height)*u);setFrameSize(d,parseInt(d.style.width)*r,parseInt(d.style.height)*r);if(f.getAttribute("side")=="left"){d.style.marginLeft=(parseInt(f.style.width)-d.offsetLeft)+"px";f.style.marginLeft=(-f.offsetLeft)+"px";}else{f.style.marginLeft=(parseInt(d.style.width)-f.offsetLeft)+"px";d.style.marginLeft=(-d.offsetLeft)+"px";}f.style.marginTop=-f.offsetTop+"px";d.style.marginTop=-d.offsetTop+"px";if(s.clientWidth<s.scrollWidth){var p=t*g;s.scrollLeft=p-l;s.style.overflowX="scroll";}else{s.style.overflowX="hidden";}if(s.clientHeight<s.scrollHeight){var o=q*g;s.scrollTop=o-k;s.style.overflowY="scroll";}else{s.style.overflowY="hidden";}alignContent(f,f.getAttribute("data-originalWidth"),f.getAttribute("data-originalHeight"),parseInt(f.style.width),parseInt(f.style.height),f.getAttribute("data-pageProperty"));alignContent(d,d.getAttribute("data-originalWidth"),d.getAttribute("data-originalHeight"),parseInt(d.style.width),parseInt(d.style.height),d.getAttribute("data-pageProperty"));}function zoomViewAt(l,k,g){var r=document.getElementById(currentFrame.valueOf());var v=r.getAttribute("data-panelFitZoom");if(!v&&!isSinglePage()){zoomTwoPageView(l,k,g);return;}var n=r.contentWindow.document.body;prepareBodyStyle(n);var h=r.contentWindow.document.getElementsByTagName("html")[0];h.style.overflow="hidden";var c=getCurrentZoom(n.style);var m=Math.min(c*g,maxZoom);var f=r.getAttribute("data-fitZoom");if(!v){m=Math.max(m,parseFloat(f)*1);}else{m=Math.max(m,parseFloat(v)*1);}var u=n.scrollLeft+l;var s=n.scrollTop+k;setCurrentZoom(n.style,m,0,0);if(n.clientWidth<n.scrollWidth){var q=u*(m/c);n.scrollLeft=q-l;}if(n.clientHeight<n.scrollHeight){var p=s*(m/c);n.scrollTop=p-k;}h.style.overflowX="hidden";h.style.overflowY="hidden";var d=r.getAttribute("data-panelTargetId");var j=0;var o=0;if(v){var e=parseInt(r.getAttribute("data-panelLeft"));var t=parseInt(r.getAttribute("data-panelTop"));var a=parseInt(r.getAttribute("data-panelWidth"));var b=parseInt(r.getAttribute("data-panelHeight"));originalLeft=e;originalTop=t;r.setAttribute("data-panelWidth",a*(m/c));r.setAttribute("data-panelHeight",b*(m/c));r.setAttribute("data-panelLeft",e*(m/c));r.setAttribute("data-panelTop",t*(m/c));}if(m==v){if(d){n.scrollLeft=0;n.scrollTop=0;}else{n.scrollLeft=parseInt(r.getAttribute("data-panelLeft"));n.scrollTop=parseInt(r.getAttribute("data-panelTop"));}}else{addScrollBars();}if(d){centerPanel(r,d,deviceW,deviceH);var e=parseFloat(r.getAttribute("data-panelLeft"));var t=parseFloat(r.getAttribute("data-panelTop"));if(m!=v){n.scrollTop=n.scrollTop-((originalTop-t)*(m/c));n.scrollLeft=n.scrollLeft-((originalLeft-e)*(m/c));}}else{alignContent(r,r.getAttribute("data-originalWidth"),r.getAttribute("data-originalHeight"),deviceW,deviceH,CENTER);}}function isSinglePage(){if(deviceW>deviceH&&orientationLock!="landscape"&&curPairedPage!=INVALID_PAGE_VALUE){return false;}return true;}function getScrollTop(a){var c=document.getElementById(a.valueOf());if(!isSinglePage()){var b=document.getElementById("divScroll");return b.scrollTop;}else{return c.contentDocument.body.scrollTop;}}function getScrollLeft(a){var c=document.getElementById(a.valueOf());if(!isSinglePage()){var b=document.getElementById("divScroll");return b.scrollLeft;}else{return c.contentDocument.body.scrollLeft;}}function getOffsetTop(a){var b=document.getElementById(a.valueOf());return parseInt(b.offsetTop);}function getOffsetLeft(a){var b=document.getElementById(a.valueOf());return parseInt(b.offsetLeft);}function getPageInFrame(a){var b=document.getElementById(a.valueOf());return parseInt(b.getAttribute("page"));}function addScrollBars(){var e=0;var d=0;var c=document.getElementById(currentFrame.valueOf());var b=c.contentWindow.document.body;var a=c.contentWindow.document.getElementsByTagName("html")[0];if(b.clientWidth<b.scrollWidth){e=1;}else{a.style.overflowX="hidden";}if(b.clientHeight<b.scrollHeight){d=1;}else{a.style.overflowY="hidden";}if(e==1){a.style.overflowX="scroll";}if(d==1){a.style.overflowY="scroll";}if(e!=1&&d!=1){fitLoadedContent(currentFrame,deviceW,deviceH);}}function panTwoPageView(c,b){var d=document.getElementById("divScroll");var a=d.scrollLeft;var e=d.scrollTop;d.scrollLeft=d.scrollLeft+c;d.scrollTop=d.scrollTop+b;d.setAttribute("data-deltaX",parseInt(a-d.scrollLeft));d.setAttribute("data-deltaY",parseInt(e-d.scrollTop));}function panVirtualPanel(f){var d=f.contentDocument.getElementsByTagName("html")[0];var g=f.contentDocument.body;var j=0;var c=0;var b=0;var e=0;if(f.getAttribute("data-panelLeft")){j=parseInt(f.getAttribute("data-panelLeft"));}if(f.getAttribute("data-panelWidth")){b=parseInt(f.getAttribute("data-panelWidth"));}if(f.getAttribute("data-panelTop")){c=parseInt(f.getAttribute("data-panelTop"));}if(f.getAttribute("data-panelHeight")){e=parseInt(f.getAttribute("data-panelHeight"));}var h=g.scrollLeft;var a=g.scrollTop;if(h<j||h>(j+b-deviceW)){g.scrollLeft=Math.min(h,(j+b-deviceW));g.scrollLeft=Math.max(g.scrollLeft,j);}if(a<c||a>(c+e-deviceH)){g.scrollTop=Math.min(a,(c+e-deviceH));g.scrollTop=Math.max(g.scrollTop,c);}}function panPublisherPanel(f){var d=f.contentDocument.getElementsByTagName("html")[0];var g=f.contentDocument.body;var j=0;var c=0;var b=0;var e=0;if(f.getAttribute("data-scrollWidth")){b=parseInt(f.getAttribute("data-scrollWidth"));}if(f.getAttribute("data-scrollHeight")){e=parseInt(f.getAttribute("data-scrollHeight"));}var h=g.scrollLeft;var a=g.scrollTop;if(h>b){g.scrollLeft=Math.min(h,b);}if(a>e){g.scrollTop=Math.min(a,e);}}function panViewAllowOverwrite(d,b,h){var g=document.getElementById(currentFrame.valueOf());var f=g.getAttribute("data-panelFitZoom");if(!isSinglePage()&&!f){panTwoPageView(d,b);return;}var j=g.contentWindow.document.body;var e=g.contentWindow.document.getElementsByTagName("html")[0];var k=j.scrollLeft;var a=j.scrollTop;j.scrollLeft=j.scrollLeft+d;j.scrollTop=j.scrollTop+b;if(f&&h==0){var c=g.getAttribute("data-panelType");if(c==COMIC){panPublisherPanel(g);}else{if(c==MANGA){panVirtualPanel(g);}}}g.setAttribute("data-deltaX",parseInt(k-j.scrollLeft));g.setAttribute("data-deltaY",parseInt(a-j.scrollTop));}function panView(b,a){panViewAllowOverwrite(b,a,0);}function getDeltaX(){var c=document.getElementById(currentFrame.valueOf());var a=c.getAttribute("data-panelFitZoom");if(!isSinglePage()&&!a){var b=document.getElementById("divScroll");return parseInt(b.getAttribute("data-deltaX"));}else{return parseInt(c.getAttribute("data-deltaX"));}}function getDeltaY(){var c=document.getElementById(currentFrame.valueOf());var a=c.getAttribute("data-panelFitZoom");if(!isSinglePage()&&!a){var b=document.getElementById("divScroll");return parseInt(b.getAttribute("data-deltaY"));}else{return parseInt(c.getAttribute("data-deltaY"));}}function getScrollClientWidth(){var d=document.getElementById(currentFrame.valueOf());var a=d.getAttribute("data-panelFitZoom");if(!isSinglePage()&&!a){var b=document.getElementById("divScroll");return(parseInt(b.clientWidth));}else{var c=d.contentDocument.body;return parseInt(c.clientWidth);}}function getScrollClientHeight(){var d=document.getElementById(currentFrame.valueOf());var a=d.getAttribute("data-panelFitZoom");if(!isSinglePage()&&!a){var b=document.getElementById("divScroll");return(parseInt(b.clientHeight));}else{var c=d.contentDocument.body;return parseInt(c.clientHeight);}}function clearFrameAttributes(b,a){b.removeAttribute("data-panelFitZoom");b.removeAttribute("data-panelLeft");b.removeAttribute("data-panelTop");b.removeAttribute("data-panelWidth");b.removeAttribute("data-panelHeight");b.removeAttribute("data-scrollWidth");b.removeAttribute("data-scrollHeight");b.removeAttribute("data-panelTargetId");b.removeAttribute("data-panelType");b.removeAttribute("data-originalWidth");b.removeAttribute("data-originalHeight");if(a){b.removeAttribute("data0-originalWidth");b.removeAttribute("data0-originalHeight");}}function gotoStandardView(){if(isSinglePage()){var b=document.getElementById(currentFrame.valueOf());clearFrameAttributes(b);fitLoadedContent(currentFrame,deviceW,deviceH);}else{var e=document.getElementsByTagName("iframe");var a=0;for(a=0;a<e.length;a++){clearFrameAttributes(e[a]);}var d=findFrameForPage(parseInt(curBasePage));var c=findFrameForPage(parseInt(curPairedPage));showAndPositionTwoPages(d,c,ltr,true);}}function getComputedWidth(a){return parseInt(a.offsetWidth);}function getComputedHeight(a){return parseInt(a.offsetHeight);}function centerPanel(y,f,d,x){var o=y.contentWindow.document;var t=o.getElementById(f);var j=t;var c=t.childNodes;for(i=0;i<c.length;i++){var b=c[i];var l=o.defaultView.getComputedStyle(b,null);if(l!=null){var g=parseInt(l.opacity);var k=l.left;var s=l.top;var m=l.bottom;var w=l.right;if((k!="auto"||s!="auto"||m!="auto"||w!="auto")&&c[i].nodeName!="IMG"){j=c[i];}}}prepareBodyStyle(o.body);iframeHtml=o.getElementsByTagName("html")[0];o.body.style.width="auto";o.body.style.height="auto";var p=getComputedWidth(j);var u=getComputedHeight(j);var k=0;var s=0;var q=getCurrentZoom(o.body.style);d=d/q;x=x/q;if(p<d){k=Math.floor((d-p)/2);}if(u<x){s=Math.floor((x-u)/2);}elementParent=j.offsetParent;while(elementParent!=null&&elementParent!=o.body){k-=parseInt(elementParent.offsetLeft);s-=parseInt(elementParent.offsetTop);elementParent=elementParent.offsetParent;}j.style.left=k+"px";j.style.top=s+"px";j.style.right="";j.style.bottom="";y.setAttribute("data-panelLeft",((deviceW-(p*q))/2));y.setAttribute("data-panelTop",((deviceH-(u*q))/2));y.setAttribute("data-panelWidth",p*q);y.setAttribute("data-panelHeight",u*q);var e=parseFloat(p*q);var h=parseFloat(k*q);var a=parseFloat(u*q);var n=parseFloat(s*q);var r=parseInt(h+e-deviceW);var v=parseInt(n+a-deviceH);y.setAttribute("data-scrollWidth",r);y.setAttribute("data-scrollHeight",v);}function getPanelZoom(){var a=document.getElementById(currentFrame.valueOf());if(a.getAttribute("data-panelFitZoom")==a.contentDocument.body.style.zoom){return a.getAttribute("data-panelFitZoom");}return"-1.0";}function getPanelTop(){var b=document.getElementById(currentFrame.valueOf());var a=b.getAttribute("data-panelTop");if(a){if(b.getAttribute("data-panelFitZoom")==b.contentDocument.body.style.zoom){return parseInt(a);}else{return parseInt(a-b.contentDocument.body.scrollTop);}}return 0;}function getPanelLeft(){var b=document.getElementById(currentFrame.valueOf());var a=b.getAttribute("data-panelLeft");if(a){if(b.getAttribute("data-panelFitZoom")==b.contentDocument.body.style.zoom){return parseInt(a);}else{return parseInt(a-b.contentDocument.body.scrollLeft);}}return 0;}function getPanelWidth(){var a=document.getElementById(currentFrame.valueOf());var b=a.getAttribute("data-panelWidth");if(b){return parseInt(b);}return -1;}function getPanelHeight(){var b=document.getElementById(currentFrame.valueOf());var a=b.getAttribute("data-panelHeight");if(a){return parseInt(a);}return -1;}function restoreTextSize(a){var b=findFrameForPage(a);if(b==null){return;}var c=b.contentDocument;c.body.style.zoom=parseFloat(b.getAttribute("data-fitZoom"));}function scaleTextSize(a,b){var e=findFrameForPage(a);currentFrame=e.id;if(e==null){return;}var g=e.contentDocument;prepareBodyStyle(g.body);var f=g.getElementById(b.valueOf());var d=g.defaultView.getComputedStyle(f,null).getPropertyValue("font-size");var c=parseInt(READABLE_FONT_SIZE)/parseInt(d);g.body.style.zoom=g.body.style.zoom*c;e.setAttribute("data-panelFitZoom",g.body.style.zoom);g.body.scrollTop=f.offsetTop*c;g.body.scrollLeft=f.offsetLeft*c;e.setAttribute("data-panelLeft",g.body.scrollLeft);e.setAttribute("data-panelTop",g.body.scrollTop);e.setAttribute("data-panelWidth",f.offsetWidth*c);e.setAttribute("data-panelHeight",f.offsetHeight*c);e.setAttribute("data-panelType",CHILDREN);alignContent(e,e.getAttribute("data-originalWidth"),e.getAttribute("data-originalHeight"),deviceW,deviceH,CENTER);}function currentDocString(){return(document.getElementById(currentFrame.valueOf()).contentDocument.body.innerHTML);}function fitPanelToScreen(t,h,g,s){var u=findFrameForPage(t);currentFrame=u.id;if(u==null){return;}makeFullPage(u,true);var o=u.contentWindow.document;var q=o.getElementById(h);var k=q;var f=q.childNodes;for(i=0;i<f.length;i++){var b=f[i];var m=o.defaultView.getComputedStyle(b,null);if(m!=null){var j=parseInt(m.opacity);if(j!=1){b.style.opacity=1;b.style.backgroundColor="#fff";}var l=m.left;var p=m.top;var n=m.bottom;var r=m.right;if((l!="auto"||p!="auto"||r!="auto"||n!="auto")&&f[i].nodeName!="IMG"){k=f[i];}}}prepareBodyStyle(o.body);o.body.style.zoom="1.0";iframeHtml=o.getElementsByTagName("html")[0];iframeHtml.style.overflow="hidden";o.body.style.width="auto";o.body.style.height="auto";var c=getComputedWidth(k);var e=getComputedHeight(k);var v=g/c;var d=s/e;var a=Math.min(v,d);k.setAttribute("data-panelFitZoom",parseFloat(a));u.setAttribute("data-panelFitZoom",parseFloat(a));u.setAttribute("data-panelTargetId",h);u.setAttribute("data-panelType",COMIC);console.log("new zoom is "+parseFloat(a));o.body.style.zoom=a;centerPanel(u,h,g,s);}function hasAllFramesLoaded(){var d=document.getElementsByTagName("iframe");var a=0,c=0;for(a=0;a<d.length;a++){var b=d[a].getAttribute("data-pageLoadStatus");if(b){if(b==LOADING){return 0;}c++;}}return(c>0)?1:0;}function templateLoaded(){var a=0;var b=document.getElementsByTagName("iframe");for(a=0;a<b.length;a++){b[a].addEventListener("load",loaded,false);b[a].setAttribute("data-frameStatus","hidden");b[a].setAttribute("page",INVALID_PAGE_VALUE);}}function pageHasSingleImageOnly(){var b=document.getElementById(currentFrame.valueOf()).contentDocument;var a=b.body.textContent.replace(/\s*/,"").length==0&&b.images.length==1;return(a)?1:0;}window.addEventListener("load",templateLoaded,false);